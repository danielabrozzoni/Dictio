<html>
    <head>
        <script src="/socket.io/socket.io.js"></script>
    </head>
    <body>

        <div id="menu">
            <input type = "text" id = "code">
            <button onClick="joinRoom(document.getElementById('code').value)"> JOIN GAME </button>
        <br>
            <button onClick="createRoom()"> NEW GAME</button>
        </div>

        <div id="game" style="display: none;">
            <p id = "scritta"> </p>
            <p id = "counter"> </p>
            <p id = "timer"> </p>
        </div>

        <div id="answer" style="display: none;">
            <p id="question">

            </p>
            <p>
                <button id="answer1" onclick="answerChosed(1)">domanda 1</button><br>
                <button id="answer2" onclick="answerChosed(2)">domanda 2</button><br>
                <button id="answer3" onclick="answerChosed(3)">domanda 3</button><br>
                <button id="answer4" onclick="answerChosed(4)">domanda 4</button><br>
            </p>
        </div>

        <script>

        var socket;

        var nQuestion = 1;

        socket = io();

        var createRoom = function() {

            socket.emit('New room');

            //show_room();
        }

        var joinRoom = function(_code) {

            socket.emit('Join room', {
                code : _code
            });

        }

        function set_content_with_id(id, content) {
            document.getElementById(id).innerHTML = content;
        }

        function show_menu() {

            document.getElementById("menu").style.display = "block";
            document.getElementById("game").style.display = "none";
            document.getElementById("answer").style.display = "none";
        }

        function show_game() {
            document.getElementById("menu").style.display = "none";
            document.getElementById("game").style.display = "block";
            document.getElementById("answer").style.display = "none";
        }


        function show_answer() {
            document.getElementById("menu").style.display = "none";
            document.getElementById("game").style.display = "none";
            document.getElementById("answer").style.display = "block";
        }

        function join_room() {

            show_game();
            document.getElementById("scritta").innerHTML = "Questa è una stanza!";
        }

        function new_room(code) {

            show_game();
            document.getElementById("scritta").innerHTML =
                                    "Questa è una nuova stanza! Codice:" + code;
        }

        function players_counter(counter) {
            document.getElementById("counter").innerHTML = "" + counter;
        }

        function preparation_time(timer) {
            document.getElementById("timer").innerHTML = "Timer: " + timer;
        }

        socket.on("Room joined", function(data) {

            join_room();
            players_counter(data.counter + "/" + data.max_player);

        });

        socket.on("Room created", function(data) {

            new_room(data.code);
            players_counter(1 + "/" + data.max_player);
        });


        socket.on("Players counter", function(data) {
            players_counter(data.counter + "/" + data.max_player);
        });

        socket.on("Preparation time", function(data) {
            console.log(data.timer);
            preparation_time(data.timer);
        });

        socket.on("Send question " + nQuestion, function(data) {

            set_content_with_id("question", data.question);

            set_content_with_id("answer1", data.answers[0]);
            set_content_with_id("answer2", data.answers[1]);
            set_content_with_id("answer3", data.answers[2]);
            set_content_with_id("answer4", data.answers[3]);

            show_answer();
        });

        socket.on("ciao", function () {
            alert("tutti hanno risposto");
        });

        function answerChosed(nAnswer){

            if(nAnswer < 0 || nAnswer > 4) {
                return;
            }

            console.log("Sending answer to server...");

            socket.emit("Receive question", {
                nActualQuestion: nQuestion,
                nActualAnswer: nAnswer
            });
        }


        show_menu();
        </script>

    </body>
</html>
